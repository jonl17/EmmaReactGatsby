/*! laytheme 31-07-2018 */

var FontManager=new Marionette.Application;FontManager.addRegions({mainRegion:"#fontmanager"}),FontManager.on("start",function(){FontManager.trigger("manager:show")}),jQuery(document).ready(function(){FontManager.start()}),FontManager.module("Entities",function(n,t,e,o,a,i){var l={jsonObject:null};n.API={getRowsEntities:function(){return d()},updateJSON:function(){r()},getJSON:function(){s()},getJSONObject:function(){return l.jsonObject}},n.Row=e.Model.extend({}),n.RowsCollection=e.Collection.extend({model:n.Row});var d=function(){var t=[];return null!=l.jsonObject&&(t=l.jsonObject),rowsCollection=new n.RowsCollection(t),rowsCollection},s=function(){var n=a.trim(a("#fontmanager_json").val());if(void 0!==n&&""!=n){var t=JSON.parse(n);l.jsonObject=t}},r=function(){var n=t.module("Row").API.getRowsView().collection.toJSON(),e=window.JSON.stringify(n,void 0,2);a("#fontmanager_json").val(e)}}),FontManager.module("FontManagerApp",function(n,t,e,o,a,i){t.on("manager:show",function(){t.module("Manager").API.showManager()})}),FontManager.module("Manager",function(n,t,e,o,a,i){n.API={showManager:function(){s()},hideModal:function(){d()}};var l=function(){a("#add-webfont-input-modal .close-modal-btn").on("click",function(){d()}),a("#add-webfont-input-modal .background").on("click",function(){d()}),a(document).keyup(function(n){27==n.keyCode&&d()})},d=function(){a("#add-webfont-input-modal").hide(),a("#add-webfont-input-modal .webfont-type-choice-wrap").show(),a("#add-webfont-input-modal .lay-webfont-form").hide(),a("#add-webfont-input-modal .js-ok-button").hide().attr("disabled","disabled"),a(".js-link-font-name-input").removeAttr("disabled").val("").parsley().validate(),a(".js-link-tag-input").val("").parsley().validate(),a(".js-link-font-family-input").val("").parsley().validate(),a(".js-js-font-name-input").removeAttr("disabled").val("").parsley().validate(),a(".js-js-embed-code").val("").parsley().validate(),a(".js-js-font-family-input").val("").parsley().validate(),a("#add-webfont-input-modal").removeClass("edit-mode")},s=function(){t.module("Entities").API.getJSON();var n=t.module("Entities").API.getRowsEntities();t.module("Row").API.initRows(n);var e=t.module("Row").API.getRowsView();t.mainRegion.show(e),t.module("LinkAndCSSModal").API.initModule(),t.module("JSAndCSSModal").API.initModule(),l(),a('[data-toggle="tooltip"]').tooltip({container:".webfont-type-choice-wrap"})}}),FontManager.module("JSAndCSSModal",function(n,t,e,o,a,i){var l={validFontName:!1,validJSEmbedCode:!1,validFontFamily:!1};n.API={initModule:function(){u(),s(),r()},setAllInputsToValid:function(){d()}};var d=function(){l.validFontName=!0,l.validJSEmbedCode=!0,l.validFontFamily=!0},s=function(){window.ParsleyValidator.addValidator("scripttag",function(n,t){var e=!1;n.substr(n.length-1);return"<script"==n.substr(0,7)&&">"==lastChar&&(e=!0),e},32).addMessage("en","scripttag",'Valid "script" tags begin with "<script" and end with ">"'),a.listen("parsley:field:error",function(n){arrErrorMsg=ParsleyUI.getErrorsMessages(n),errorMsg=arrErrorMsg.join(";"),n.$element.popover("destroy").popover({container:"body",placement:"bottom",content:errorMsg}).popover("show")}),a.listen("parsley:field:success",function(n){n.$element.popover("destroy")})},r=function(){a(".js-js-font-name-input").on("input propertychange",function(){l.validFontName=a(this).parsley().validate(),c()}),a(".js-js-embed-code").on("input propertychange",function(){l.validJSEmbedCode=a(this).parsley().validate(),c()}),a(".js-js-font-family-input").on("input propertychange",function(){l.validFontFamily=a(this).parsley().validate(),c()})},c=function(){1==l.validJSEmbedCode&&1==l.validFontName&&1==l.validFontFamily?a(".js-add-js-font-btn").removeAttr("disabled"):a(".js-add-js-font-btn").attr("disabled","disabled")},u=function(){a("#add-webfont-input-modal .js-add-js-font-btn").on("click",function(n){n.preventDefault();var e=a(".js-js-embed-code").val(),o=a(".js-js-font-name-input").val(),i=a(".js-js-font-family-input").val();a("#add-webfont-input-modal").hasClass("edit-mode")?t.module("Row").API.editFontRowByScriptAndCSS(o,e,i):t.module("Row").API.insertFontRowByScriptAndCSS(o,e,i),t.module("Manager").API.hideModal()})}}),FontManager.module("LinkAndCSSModal",function(n,t,e,o,a,i){var l={validFontName:!1,validLinkTag:!1,validFontFamily:!1};n.API={initModule:function(){u(),s(),r()},setAllInputsToValid:function(){d()}};var d=function(){l.validFontName=!0,l.validLinkTag=!0,l.validFontFamily=!0},s=function(){window.ParsleyValidator.addValidator("nonumberasfirstchar",function(n,t){var e=!0,o=n.substr(0,1);return 0!=o&&1!=o&&2!=o&&3!=o&&4!=o&&5!=o&&6!=o&&7!=o&&8!=o&&9!=o||(e=!1),e},32).addMessage("en","nonumberasfirstchar","Please don't use a number as a first character"),window.ParsleyValidator.addValidator("linktag",function(n,t){var e=!1,o=n.substr(n.length-1);return"<link"==n.substr(0,5)&&">"==o&&(e=!0),e},32).addMessage("en","linktag",'A valid "link" tag begins with "<link" and ends with ">"'),window.ParsleyValidator.addValidator("fontfamily",function(n,t){var e=!1,o=n.substr(n.length-1);return"font-family:"==n.substr(0,12)&&";"==o&&(e=!0),(n.match(/:/g)||[]).length>1&&(e=!1),e},32).addMessage("en","fontfamily",'A valid "font-family" CSS style begins with "font-family:" and ends with ";"'),a.listen("parsley:field:error",function(n){arrErrorMsg=ParsleyUI.getErrorsMessages(n),errorMsg=arrErrorMsg.join(";"),n.$element.popover("destroy").popover({container:"body",placement:"bottom",content:errorMsg}).popover("show")}),a.listen("parsley:field:success",function(n){n.$element.popover("destroy")})},r=function(){a(".js-link-font-name-input").on("input propertychange",function(){l.validFontName=a(this).parsley().validate(),c()}),a(".js-link-tag-input").on("input propertychange",function(){l.validLinkTag=a(this).parsley().validate(),c()}),a(".js-link-font-family-input").on("input propertychange",function(){l.validFontFamily=a(this).parsley().validate(),c()})},c=function(){1==l.validFontName&&1==l.validLinkTag&&1==l.validFontFamily?a(".js-add-link-font-btn").removeAttr("disabled"):a(".js-add-link-font-btn").attr("disabled","disabled")},u=function(){a("#add-webfont-input-modal .js-add-link-font-btn").on("click",function(n){n.preventDefault();var e=a(".js-link-font-family-input").val(),o=a(".js-link-tag-input").val(),i=a(".js-link-font-name-input").val();a("#add-webfont-input-modal").hasClass("edit-mode")?t.module("Row").API.editFontRowByLinkAndCSS(i,o,e):t.module("Row").API.insertFontRowByLinkAndCSS(i,o,e),t.module("Manager").API.hideModal()})}}),FontManager.module("Uploader",function(n,t,e,o,a,i){var l={modal:null};n.API={showModal:function(){d()}};var d=function(){l.modal=wp.media.frames.modal=wp.media({title:"Upload .woff",library:{type:["application/octet-stream","application/font-woff","application/x-font-woff","font/woff","font/woff2"]},button:{text:"Ok"},multiple:!1}),l.modal.on("open",function(){"upload"!=l.modal.content._mode&&l.modal.content.mode("upload")}),l.modal.on("select",function(){var n=l.modal.state().get("selection").toJSON(),e=n[0].filename.charAt(0);a.isNumeric(e)?window.alert("Error: Please make sure your .woff filename does not start with a number."):t.module("Row").API.insertFontRowByAttachment(n[0])}),l.modal.open()}}),FontManager.module("Row",function(n,t,e,o,a,i){var l={rowsView:null};n.API={initRows:function(n){m(n)},getRowsView:function(){return l.rowsView},insertFontRowByAttachment:function(n){r(n)},insertFontRowByLinkAndCSS:function(n,t,e){s(n,t,e)},insertFontRowByScriptAndCSS:function(n,t,e){d(n,t,e)},deleteFontRow:function(n){c(n)},showEditFontRowModal:function(n){p(n)},editFontRowByLinkAndCSS:function(n,t,e){u(n,t,e)},editFontRowByScriptAndCSS:function(n,t,e){f(n,t,e)}};var d=function(n,o,i){a("head").append(o);var i=i.replace(/"/g,"'"),d=new e.Model({fontname:n,script:o,css:i,type:"script"});l.rowsView.collection.add(d),t.module("Entities").API.updateJSON()},s=function(n,o,i){a("head").prepend(o);var i=i.replace(/"/g,"'"),d=new e.Model({fontname:n,link:o,css:i,type:"link"});l.rowsView.collection.add(d),t.module("Entities").API.updateJSON()},r=function(n){if(-1!=n.filename.indexOf(".woff")){var o='<style>@font-face{ font-family: "'+n.title+'"; src: url("'+n.url+'") format("woff"); }</style>';a("head").append(o);var i=new e.Model({fontname:n.title,url:n.url,id:n.id,type:"attachment"});l.rowsView.collection.add(i),t.module("Entities").API.updateJSON()}else a(".wrong-file-notice").css("display","block"),l.showNoticeTimeout=setTimeout(function(){a(".wrong-file-notice").fadeOut()},2500)},c=function(n){l.rowsView.collection.remove(n),t.module("Entities").API.updateJSON()},u=function(n,e,o){var i=l.rowsView.collection.where({fontname:n})[0];a("head").append(e);var o=o.replace(/"/g,"'");i.set("link",e),i.set("css",o),t.module("Entities").API.updateJSON()},f=function(n,e,o){var i=l.rowsView.collection.where({fontname:n})[0];a("head").append(e);var o=o.replace(/"/g,"'");i.set("script",e),i.set("css",o),t.module("Entities").API.updateJSON()},p=function(n){switch(n.get("type")){case"link":a("#add-webfont-input-modal").addClass("edit-mode"),a(".js-add-font").click(),a(".js-link-css-btn").click(),a(".js-link-font-name-input").val(n.get("fontname")).attr("disabled","disabled"),a(".js-link-tag-input").val(n.get("link")).parsley().validate(),a(".js-link-font-family-input").val(n.get("css")).parsley().validate(),t.module("LinkAndCSSModal").API.setAllInputsToValid();break;case"script":a("#add-webfont-input-modal").addClass("edit-mode"),a(".js-add-font").click(),a(".js-js-css-btn").click(),a(".js-js-font-name-input").val(n.get("fontname")).attr("disabled","disabled"),a(".js-js-embed-code").val(n.get("script")).parsley().validate(),a(".js-js-font-family-input").val(n.get("css")).parsley().validate(),t.module("JSAndCSSModal").API.setAllInputsToValid()}},m=function(t){l.rowsView=new n.Rows({collection:t}),w()},w=function(){}}),FontManager.module("Row",function(n,t,e,o,a,i){n.Row=o.ItemView.extend({template:"#row-view",initialize:function(){this.model.on("change",this.render,this)},className:"row-wrap",tagName:"tr",templateHelpers:function(){var n=this.model;return{showFontName:function(){if(n.get("fontname"))return n.get("fontname")},showFontCSS:function(){var t=n.get("type");return"link"==t||"script"==t?'style="'+n.get("css")+'"':'style="font-family:'+n.get("fontname")+';"'},showText:function(){if(n.get("fontname"))return"The quick brown fox jumps over the lazy dog."},showType:function(){var t=n.get("type");return t||"attachment"}}},events:{"click .js-delete-row":"deleteRow","click .js-edit-row":"showEditFontRowModal"},deleteRow:function(t){t.preventDefault(),n.API.deleteFontRow(this.model)},showEditFontRowModal:function(t){t.preventDefault(),n.API.showEditFontRowModal(this.model)}}),n.Rows=o.CompositeView.extend({tagName:"div",template:"#row-composite-view",childViewContainer:".rows",childView:n.Row,events:{"click .js-add-font":"showAddFontModal","click .js-upload-woff-btn":"showUploader","click .js-link-css-btn":"showLinkCSSModal","click .js-js-css-btn":"showJSCSSModal"},showAddFontModal:function(n){n.preventDefault(),a("#add-webfont-input-modal").show()},showUploader:function(n){n.preventDefault(),t.module("Uploader").API.showModal(),t.module("Manager").API.hideModal()},showLinkCSSModal:function(){a("#add-webfont-input-modal .webfont-type-choice-wrap").hide(),a("#add-webfont-input-modal .link-css-modal").show(),a(".js-add-link-font-btn").show()},showJSCSSModal:function(){a("#add-webfont-input-modal .webfont-type-choice-wrap").hide(),a("#add-webfont-input-modal .js-css-modal").show(),a(".js-add-js-font-btn").show()}})});